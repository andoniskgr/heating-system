{
  "meta": {
    "project": "Raspberry Pi Pico Heating System Monitor",
    "date": "2026-01-31",
    "prepared_by": "Generated by Software Development Manager"
  },
  "product_overview": "This product integrates a Raspberry Pi Pico W with an ultrasonic sensor and relay control to monitor and manage a heating system's fuel level and operational state. It connects to WiFi, synchronizes time, and communicates with Firebase Realtime Database for remote monitoring and control via an Android app.",
  "core_goals": [
    "Enable remote control of the heating system (ON/OFF) via Firebase commands.",
    "Continuously monitor the petrol tank level using an ultrasonic distance sensor and update the data in Firebase.",
    "Maintain accurate timestamps by syncing device time through NTP server on WiFi connection.",
    "Provide reliable and real-time data synchronization between the Raspberry Pi Pico device and the Firebase Realtime Database.",
    "Log history of tank levels and system states for monitoring and analytics.",
    "Allow an Android application to read the updated data from Firebase for user interaction."
  ],
  "key_features": [
    "WiFi connection setup using STA mode with NTP time synchronization on connect.",
    "Ultrasonic sensor (HC-SR04) integration for measuring petrol tank level in centimeters.",
    "Relay control on GPIO15 for heating system ON/OFF with active-low logic.",
    "Firebase Realtime Database connectivity for updating current system status, tank level, timestamps, and maintaining a history log.",
    "Polling Firebase command.json to receive system commands (ON/OFF) and manual updates, with command deduplication.",
    "Periodic status updates to Firebase every 30 minutes when the relay is ON, configurable interval.",
    "Utility functions for formatting timestamps as 'YYYY-MM-DD HH:MM:SS'.",
    "Firebase connection test at startup to verify network and database availability."
  ],
  "user_flow_summary": [
    "Device boots and connects to WiFi in STA mode; synchronizes time via NTP.",
    "Device tests Firebase connectivity by sending a test payload at startup.",
    "Ultrasonic sensor reads distance values representing petrol tank level periodically.",
    "Device polls Firebase 'command.json' for possible ON/OFF commands or manual updates.",
    "Upon receiving a valid command, device controls the relay accordingly to turn heating ON/OFF.",
    "Device updates Firebase database with current system status, petrol level, and timestamp.",
    "Device logs each update to Firebase history for record keeping.",
    "While heating is ON, device sends periodic status updates every 30 minutes to Firebase.",
    "Android app reads the Firebase database to display heating system status and petrol level to users."
  ],
  "validation_criteria": [
    "Successful WiFi connection and stable NTP time synchronization on device startup.",
    "Accurate readings from the ultrasonic sensor reflecting actual petrol tank level.",
    "Relay control responsiveness correctly turns heating system ON and OFF based on received commands.",
    "Firebase database updates show real-time and historical data for system status and tank level.",
    "Polling mechanism accurately detects and applies Firebase commands without duplication or loss.",
    "Periodic updates occur on schedule when the heating system is ON.",
    "Timestamp format complies with 'YYYY-MM-DD HH:MM:SS' and updates correspond to actual event times.",
    "Firebase connection test at startup completes with successful write and read confirmation."
  ],
  "code_summary": {
    "tech_stack": [
      "MicroPython",
      "Raspberry Pi Pico",
      "network (WiFi STA)",
      "urequests (HTTP)",
      "Firebase Realtime Database",
      "machine (GPIO)",
      "ntptime"
    ],
    "features": [
      {
        "name": "WiFi connection",
        "description": "Connects to WiFi using STA_IF, syncs time via NTP on connect.",
        "files": [
          "main.py"
        ]
      },
      {
        "name": "Ultrasonic distance sensor",
        "description": "Reads distance in cm from HC-SR04 on TRIG=GP3, ECHO=GP2 (get_distance).",
        "files": [
          "main.py"
        ]
      },
      {
        "name": "Relay control",
        "description": "Controls heating relay on GPIO 15 (active-low: LOW=ON, HIGH=OFF).",
        "files": [
          "main.py"
        ]
      },
      {
        "name": "Firebase status and history",
        "description": "Updates Firebase system state (current_status, current_level, last_update) and appends to history log (update_firebase).",
        "files": [
          "main.py"
        ]
      },
      {
        "name": "Firebase connection test",
        "description": "Writes a test payload to Firebase at startup to verify connectivity (test_firebase_connection).",
        "files": [
          "main.py"
        ]
      },
      {
        "name": "Command polling",
        "description": "Polls Firebase command.json for system_cmd (ON/OFF) and manual_update; deduplicates and drives relay + update_firebase.",
        "files": [
          "main.py"
        ]
      },
      {
        "name": "Periodic update",
        "description": "When relay is ON, sends periodic Firebase update every 30 minutes (configurable).",
        "files": [
          "main.py"
        ]
      },
      {
        "name": "Timestamp utility",
        "description": "Formats local time as YYYY-MM-DD HH:MM:SS (get_timestamp).",
        "files": [
          "main.py"
        ]
      }
    ]
  }
}
